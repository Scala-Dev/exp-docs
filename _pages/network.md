---
permalink: /network/
title: Network
keywords: network
summary: ""
---

# The EXP Network

- [Overview](#overview)
- [Channels](#channels)
  - [System Flag](#system-flag)
  - [Consumer Flag](#consumer-flag)
- [Broadcasting](#broadcasting)
- [Listening](#listening)
- [Responding](#responding)
- [Examples](#examples)

## Overview

The EXP network faciliates real time communication across the EXP platform. Messaging takes place in the form of [broadcasts](#broadcasting) and [responses](#responding). Broadcasts contain a name and JSON serializable payload and are emitted onto a specified [channel](#channels). Entities can listen on channels for broadcasts with a specified name, and respond to the broadcast with a JSON serializable payload. The broadcaster receives a JSON array of response payloads.


## Channels

Channels provide namespacing for messaging and help reduce network traffic by routing broadcasts to only devices that are actively listening on the given channel.

In addition to a channel name, channels have two flags `system` and `consumer`. The channel name can be any string. The full channel is defined by the combination of the organization, channel name, and these two flags. Channels with the same name, but different flags are **NOT** the same channel.


### System Flag

Broadcasts sent directly by EXP system will always be on `system` channels. Trying to emit a broadcast on a `system` channel will result in an error.

### Consumer Flag

As consumer app credentials are typically delivered with a mobile application to the consumer, messages from consumer apps should be treated with caution. For this reason, all broadcasts from consumer app devices can only be on emitted on `consumer` channels. Consumer apps can also only listen for messages on `consumer` channels. This allows non-consumer devices to communicate freely on non-consumer channels without having to worry about abuse of consumer app credentials.


### Advanced Topic: Generating a Channel ID

Under the hood, channels are actually defined by a hash of the organization, name, and flags. This is refered to as the channel ID. The hash can be generated by creating a JSON string from the array [org, name, system, consumer] where system and consumer are 0 or 1 (0 for false, 1 for true). Urlsafe Base 64 encoding the resulting string is the channel id.




## Broadcasting


```javascript
exp.getChannel('myChannel').broadcast('hello', {}, 500).then(responses => {});
```


```python
responses = exp.get_channel('my channel').broadcast('hello', None, 500)
```




Sending a broadcast is as simple as sending a HTTP POST to `/api/networks/current/broadcasts`.

```javascript
{
  "name": "myEventName",
  "payload": {
    "anything": 2,
    "anything2": ["hi!"]
  },
  "channel": {
    "name": "myChannelName",
    "consumer": true
  }
}
```

The broadcast is made up of 3 components, the channel, the message name, and the message payload. In this case the consumer flag is set.

The response to the HTTP request is a list of response payloads that were received while the HTTP request was open.

To specify the amount of wait for responses, add a `timeout` query parameter to the broadcast, specifying the number of milliseconds to wait for responses to the broadcast: i.e. `/api/networks/current/broadcasts?timeout=5000`. The HTTP request will be kept open for approximately the given timeout.




## Listening


### Advanced Topic: Manual Connection

Listening for broadcasts requires an active socket connection to the EXP Network. The easiest way to listen is to use one of the EXP SDKs.

The authentication field `network` contains information about which host you shoudl establish a connection to in order to listen for events. EXP network servers use the SocketIO protocol. Using a SocketIO client, connect to the host provided in `network.host` and pass your authentication token as the `token` query param. Once a connection is established, you will need to subscribe to a channel. Send the `subscribe` event with a list of channel ids you wish to listen on. You will subsequently receive a `subscribed` event containing a list of channel ids you are now subscribed to. If you get disconnected you will need to resubscribe to all channels.

Once subscribed to a channel, you will begin to receive broadcasts. The broadcast payload looks like:

```
{
  "id": ""
  "name": ""
  "channel": ""
  "payload": ""
}
```


